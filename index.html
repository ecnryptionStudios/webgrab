<!DOCTYPE html>
<html>
<head>
  <title>Fetch Example</title>
</head>
<body>
  <p>Hello World!</p>
  <input type="text" id="fname" placeholder="Enter URL">
  <button id="logHtmlBtn">Open Website</button>

  <script>
    document.getElementById("logHtmlBtn").addEventListener("click", async () => {
      const url = document.getElementById("fname").value.trim();
      if (!url) return alert("Enter a URL");

      try {
        // call Node.js server to fetch HTML
        const response = await fetch(`/fetch?url=${encodeURIComponent(url)}`);
        const html = await response.text();

        const w = window.open("about:blank");
        w.document.open();
        w.document.write(html);
        w.document.close();

        // re-inject scripts
        [...w.document.querySelectorAll("script")].forEach(oldScript => {
          const newScript = document.createElement("script");
          if (oldScript.src) newScript.src = oldScript.src;
          else newScript.textContent = oldScript.textContent;
          oldScript.replaceWith(newScript);
        });
      } catch (err) {
        alert("Can't open that site");
        console.error(err);
      }
    });
  </script>
</body>
</html>
